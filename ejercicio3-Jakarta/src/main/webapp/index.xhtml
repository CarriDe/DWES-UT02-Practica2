<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:c="jakarta.tags.core">

<h:head>
    <title>Ejemplo02 usando JSF con Jakarta EE 10</title>
    <meta charset="UTF-8"/>

    <style>
        body{
            font-family: "Arial"
        }
        h3{
            color: darkblue;
        }
        h2{
            color: darkred;
        }
        table {
            border-collapse: separate;
            border: 1px solid black;
            border-spacing: 0;
            border-radius: 10px;
            overflow: hidden;
            width: 50%;
        }
        th, td {
            border: 1px solid #c1d0ffff;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #c1d0ffff;
        }
        .color-rojo{
            background: #ffbbbbff;
            color: red;
        }
    </style>
</h:head>

<h:body>
    <h1>Hola desde JSF, </h1>
    <h2>Ejercicio ampliado con bucles y condicionales</h2>

    <h2>Lista de usuarios:</h2>
    <h:dataTable value="#{helloBean.usuarios}" var="usuarios" border="1">
        <h:column>
            <f:facet name="header">Nombre</f:facet>
            #{usuarios.nombre}
        </h:column>
        <h:column>
            <f:facet name="header">Apellidos</f:facet>
            #{usuarios.apellidos}
        </h:column>
        <h:column>
            <f:facet name="header">DNI</f:facet>
            #{usuarios.dni}
        </h:column>
        <h:column>
            <f:facet name="header">Email</f:facet>
            #{usuarios.email}
        </h:column>
        <h:column>
            <f:facet name="header">Edad</f:facet>
            #{usuarios.edad}
        </h:column>
        <h:column>
            <f:facet name="header">Pagos</f:facet>

            <ui:repeat value="#{usuarios.pagos.entrySet()}" var="pago">
                <div>
                    #{pago.key}:
                    <h:panelGroup rendered="#{pago.value != null}">
                        #{pago.value} €
                    </h:panelGroup>
                    <h:panelGroup rendered="#{pago.value == null}">
                        <span style="color:red; font-weight:bold;">NO PAGADO</span>
                    </h:panelGroup>
                </div>
            </ui:repeat><br/>
            <b>Total anual: #{usuarios.totalPagos} €</b><br/>

            <h:panelGroup rendered="#{usuarios.totalPagos lt 100}">
                <span style="color:red; font-weight:bold;">
                    El usuario no está al día con la cuota.
                </span>
            </h:panelGroup>

            <h:panelGroup rendered="#{usuarios.totalPagos ge 100}">
                <span style="color:green; font-weight:bold;">
                    El usuario está al corriente de pagos.
                </span>
            </h:panelGroup>            
        </h:column>
    </h:dataTable>
    
 <!-- Práctica 2: 
        * Añade aquí la sección para mostrar la lista de usuarios.
        * Comprueba si quieres primero que se muestra uno y después genera a todos.
        * Estudia como se publican aquí los elementos de un objeto dentro de una clase.
        * Utiliza la aproximación que prefieras para gestionar el total de pagos del usuario. por ejemplo, 
          puedes usar un bucle ui:repeat y variables, o crear una función dentro del objeto que calcule el total. 

   -->
    <h2>Lista de productos (con bucle ui:repeat):</h2>
    <ul>
        <ui:repeat value="#{helloBean.productos}" var="p">
            <li>
                #{p.nombre} - #{p.precio} €
                <!-- Condicional dentro del bucle -->
                <h:panelGroup rendered="#{p.precio lt 2.0}">
                    <span style="color:green;">(¡Oferta!)</span>
                </h:panelGroup>
            </li>
        </ui:repeat>
    </ul>

    <h2>Tabla de productos (con h:dataTable):</h2>
    <h:dataTable value="#{helloBean.productos}" var="p" border="1">
        <h:column>
            <f:facet name="header">Nombre</f:facet>
            #{p.nombre}
        </h:column>
        <h:column>
            <f:facet name="header">Precio</f:facet>
            #{p.precio} €
        </h:column>
    </h:dataTable>
</h:body>
</html>
